<!DOCTYPE html> 
<html lang="pl">  
<head>

	<title>KLASY</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="timer">
        <h1>TIMER</h1>
        <p>GMS</p>
        <div id="pola">
        <input type="image" id="hoursP" src="plus.png" name="hours" class="btTxt submit plus"/>
            <input type="image" id="minutesP" src="plus.png" name="minutes" class="btTxt submit plus" />
            <input type="image" id="secondsP" src="plus.png" name="seconds" class="btTxt submit plus" />
            
            <div id="licznik">
        <span id="hours">00</span><span id="minutes">00</span><span id="seconds">00</span>
                 </div>
            <div id="minusy">  
             <input type="image" id="hours" src="minus.png" name="hours" class="btTxt submit minus" />
            <input type="image" id="minutes" src="minus.png" name="minutes" class="btTxt submit minus"/>
            <input type="image" id="seconds" src="minus.png" name="seconds" class="btTxt submit minus"/>
                </div>  
        
        </div>
        <div id="przyciski">
            
            <button id="startstop">START</button>
            <br>
            <button id="reset">RESET</button>
        
        </div>    
    </div>
    <script>
var isRunning = false;
var time = {
    minutes: 0,
    seconds: 0,
    hours: 0
};
var x;
var btn = document.getElementById('startstop');

var elements = {
    hours: document.getElementById("hours"),
    minutes: document.getElementById("minutes"),
    seconds: document.getElementById("seconds")
}

var btn = document.getElementById('startstop');
var resetBtn = document.getElementById('reset');
var minusy = document.querySelectorAll('.minus');
var plusy = document.querySelectorAll('.plus');

function button() {
    btn.textContent = isRunning ? "START" : "STOP";
    btn.classList.toggle('active');
}


function updateTime(units = Object.keys(time)) {
    for (const unit of units) {
        elements[unit].textContent = `${time[unit]}`.padStart(2, '0');
    }
}

function reset() {
    clearInterval(x);

    time = {
        minutes: 0,
        seconds: 0,
        hours: 0
    };

    updateTime();
    if (isRunning) {
      button();
    minusy.forEach(function(minusEle) {
      minusEle.addEventListener('click', minus);
    });

    plusy.forEach(function(plus) {
      plus.addEventListener('click', add);
    });
    }
    isRunning = false;
     document.body.style.backgroundColor = "white";
}

function add(event) {
  const unit = event.target.name;
    if (unit !== 'hours') {
        if (time[unit] > 58) return;
    }
    time[unit]++;
    updateTime([unit]);
}

function minus(event) {
    const unit = event.target.name;
    if (time[unit] < 1) return;
    time[unit]--;
    updateTime([unit]);
}

function startstop() {
    minusy.forEach(function(minusEle) {
      minusEle.removeEventListener('click', minus);
    });

    plusy.forEach(function(plus) {
      plus.removeEventListener('click', add);
    });
    var today = new Date().getTime();
    var to = new Date(today + (time.seconds * 1000 + time.minutes * 60000 + time.hours * 3600000)).getTime();
    
    button();

    if (!isRunning) {
       
        x = setInterval(function () {
           document.body.style.backgroundColor = "white";
            today = new Date().getTime()
            var odstep = 1000 + to - today;
            time.hours = Math.floor((odstep % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            time.minutes = Math.floor((odstep % (1000 * 60 * 60)) / (1000 * 60));
            time.seconds = Math.floor((odstep % (1000 * 60)) / 1000);
            updateTime();

            time.hours = Math.floor((odstep % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            time.minutes = Math.floor((odstep % (1000 * 60 * 60)) / (1000 * 60));
            time.seconds = Math.floor((odstep % (1000 * 60)) / 1000);

            updateTime();

            if (odstep <= 1000) {
                reset();
                 document.body.style.backgroundColor = "red";
            }
        }, 1000);
        isRunning = true;
    } else {
        clearInterval(x);
        isRunning = false;
      minusy.forEach(function(minusEle) {
    minusEle.addEventListener('click', minus);
});

plusy.forEach(function(plus) {
    plus.addEventListener('click', add);
});
    }
    
}
	    
minusy.forEach(function(minusEle) {
    minusEle.addEventListener('click', minus);
});

plusy.forEach(function(plus) {
    plus.addEventListener('click', add);
});
btn.addEventListener('click', startstop);
resetBtn.addEventListener('click', reset);
    </script>
</body> 
</html>